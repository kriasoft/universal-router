{"version":3,"file":"universal-router-generate-urls.min.js","sources":["src/generateUrls.js"],"sourcesContent":["/**\n * Universal Router (https://www.kriasoft.com/universal-router/)\n *\n * Copyright Â© 2015-present Kriasoft, LLC. All rights reserved.\n *\n * This source code is licensed under the Apache 2.0 license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\n/* eslint no-param-reassign: ['error', { props: false }] */\n\nimport UniversalRouter from './UniversalRouter';\n\nconst { pathToRegexp } = UniversalRouter;\nconst cache = new Map();\n\nfunction cacheRoutes(routesByName, route, routes) {\n  if (routesByName[route.name]) {\n    throw new Error(`Route \"${route.name}\" already exists`);\n  }\n\n  if (route.name) {\n    routesByName[route.name] = route;\n  }\n\n  if (routes) {\n    for (let i = 0; i < routes.length; i += 1) {\n      const childRoute = routes[i];\n      childRoute.parent = route;\n      cacheRoutes(routesByName, childRoute, childRoute.children);\n    }\n  }\n}\n\nfunction generateUrls(router, options = {}) {\n  if (!(router instanceof UniversalRouter)) {\n    throw new TypeError('An instance of UniversalRouter is expected');\n  }\n\n  router.routesByName = router.routesByName || {};\n\n  return (routeName, params) => {\n    let route = router.routesByName[routeName];\n    if (!route) {\n      router.routesByName = {}; // clear cache\n      cacheRoutes(router.routesByName, router.root, router.root.children);\n\n      route = router.routesByName[routeName];\n      if (!route) {\n        throw new Error(`Route \"${routeName}\" not found`);\n      }\n    }\n\n    let regexp = cache.get(route.fullPath);\n    if (!regexp) {\n      let fullPath = '';\n      let rt = route;\n      while (rt) {\n        const path = Array.isArray(rt.path) ? rt.path[0] : rt.path;\n        if (path) {\n          fullPath = path + fullPath;\n        }\n        rt = rt.parent;\n      }\n      const tokens = pathToRegexp.parse(fullPath);\n      const toPath = pathToRegexp.tokensToFunction(tokens);\n      const keys = Object.create(null);\n      for (let i = 0; i < tokens.length; i += 1) {\n        if (typeof tokens[i] !== 'string') {\n          keys[tokens[i].name] = true;\n        }\n      }\n      regexp = { toPath, keys };\n      cache.set(fullPath, regexp);\n      route.fullPath = fullPath;\n    }\n\n    let url = router.baseUrl + regexp.toPath(params, options) || '/';\n\n    if (options.stringifyQueryParams && params) {\n      const queryParams = {};\n      const keys = Object.keys(params);\n      for (let i = 0; i < keys.length; i += 1) {\n        const key = keys[i];\n        if (!regexp.keys[key]) {\n          queryParams[key] = params[key];\n        }\n      }\n      const query = options.stringifyQueryParams(queryParams);\n      if (query) {\n        url += query.charAt(0) === '?' ? query : `?${query}`;\n      }\n    }\n\n    return url;\n  };\n}\n\nUniversalRouter.generateUrls = generateUrls;\n\nexport default generateUrls;\n"],"names":["cacheRoutes","routesByName","route","routes","name","Error","i","length","childRoute","parent","children","generateUrls","router","options","UniversalRouter","TypeError","routeName","params","root","regexp","cache","get","fullPath","rt","path","Array","isArray","tokens","pathToRegexp","parse","toPath","tokensToFunction","keys","Object","create","set","url","baseUrl","stringifyQueryParams","queryParams","key","query","charAt","Map"],"mappings":";4QAgBA,SAASA,EAAYC,EAAcC,EAAOC,MACpCF,EAAaC,EAAME,YACf,IAAIC,gBAAgBH,EAAME,4BAG9BF,EAAME,SACKF,EAAME,MAAQF,GAGzBC,MACG,IAAIG,EAAI,EAAGA,EAAIH,EAAOI,OAAQD,GAAK,EAAG,KACnCE,EAAaL,EAAOG,KACfG,OAASP,IACRD,EAAcO,EAAYA,EAAWE,WAKvD,SAASC,EAAaC,OAAQC,iEACtBD,aAAkBE,SAChB,IAAIC,UAAU,uDAGfd,aAAeW,EAAOX,iBAEtB,SAACe,EAAWC,OACbf,EAAQU,EAAOX,aAAae,QAC3Bd,MACID,kBACKW,EAAOX,aAAcW,EAAOM,KAAMN,EAAOM,KAAKR,YAElDE,EAAOX,aAAae,WAEpB,IAAIX,gBAAgBW,qBAI1BG,EAASC,EAAMC,IAAInB,EAAMoB,cACxBH,EAAQ,SACPG,EAAW,GACXC,EAAKrB,EACFqB,GAAI,KACHC,EAAOC,MAAMC,QAAQH,EAAGC,MAAQD,EAAGC,KAAK,GAAKD,EAAGC,KAClDA,MACSA,EAAOF,KAEfC,EAAGd,WAKL,IAHCkB,EAASC,EAAaC,MAAMP,GAC5BQ,EAASF,EAAaG,iBAAiBJ,GACvCK,EAAOC,OAAOC,OAAO,MAClB5B,EAAI,EAAGA,EAAIqB,EAAOpB,OAAQD,GAAK,EACb,iBAAdqB,EAAOrB,OACXqB,EAAOrB,GAAGF,OAAQ,MAGhB0B,SAAQE,UACbG,IAAIb,EAAUH,KACdG,SAAWA,MAGfc,EAAMxB,EAAOyB,QAAUlB,EAAOW,OAAOb,EAAQJ,IAAY,OAEzDA,EAAQyB,sBAAwBrB,EAAQ,KAGrC,IAFCsB,KACAP,EAAOC,OAAOD,KAAKf,GAChBX,EAAI,EAAGA,EAAI0B,EAAKzB,OAAQD,GAAK,EAAG,KACjCkC,EAAMR,EAAK1B,GACZa,EAAOa,KAAKQ,OACHA,GAAOvB,EAAOuB,QAGxBC,EAAQ5B,EAAQyB,qBAAqBC,GACvCE,OACyB,MAApBA,EAAMC,OAAO,GAAaD,MAAYA,UAI1CL,GAnFX,IAEQR,iDAAAA,aACFR,EAAQ,IAAIuB,WAoFlB7B,EAAgBH,aAAeA"}