{"version":3,"file":"universal-router-generate-urls.min.js","sources":["src/generateUrls.js"],"sourcesContent":["/**\n * Universal Router (https://www.kriasoft.com/universal-router/)\n *\n * Copyright (c) 2015-present Kriasoft.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport pathToRegexp from 'path-to-regexp'\n\nconst cache = new Map()\n\nfunction cacheRoutes(routesByName, route, routes) {\n  if (routesByName.has(route.name)) {\n    throw new Error(`Route \"${route.name}\" already exists`)\n  }\n\n  if (route.name) {\n    routesByName.set(route.name, route)\n  }\n\n  if (routes) {\n    for (let i = 0; i < routes.length; i++) {\n      const childRoute = routes[i]\n      childRoute.parent = route\n      cacheRoutes(routesByName, childRoute, childRoute.children)\n    }\n  }\n}\n\nfunction generateUrls(router, options = {}) {\n  if (!router) {\n    throw new ReferenceError('Router is not defined')\n  }\n\n  router.routesByName = router.routesByName || new Map()\n\n  return (routeName, params) => {\n    let route = router.routesByName.get(routeName)\n    if (!route) {\n      router.routesByName.clear() // clear cache\n      cacheRoutes(router.routesByName, router.root, router.root.children)\n\n      route = router.routesByName.get(routeName)\n      if (!route) {\n        throw new Error(`Route \"${routeName}\" not found`)\n      }\n    }\n\n    let regexp = cache.get(route.fullPath)\n    if (!regexp) {\n      let fullPath = ''\n      let rt = route\n      while (rt) {\n        const path = Array.isArray(rt.path) ? rt.path[0] : rt.path\n        if (path) {\n          fullPath = path + fullPath\n        }\n        rt = rt.parent\n      }\n      const tokens = pathToRegexp.parse(fullPath)\n      const toPath = pathToRegexp.tokensToFunction(tokens)\n      const keys = Object.create(null)\n      for (let i = 0; i < tokens.length; i++) {\n        if (typeof tokens[i] !== 'string') {\n          keys[tokens[i].name] = true\n        }\n      }\n      regexp = { toPath, keys }\n      cache.set(fullPath, regexp)\n      route.fullPath = fullPath\n    }\n\n    let url = router.baseUrl + regexp.toPath(params, options) || '/'\n\n    if (options.stringifyQueryParams && params) {\n      const queryParams = {}\n      const keys = Object.keys(params)\n      for (let i = 0; i < keys.length; i++) {\n        const key = keys[i]\n        if (!regexp.keys[key]) {\n          queryParams[key] = params[key]\n        }\n      }\n      const query = options.stringifyQueryParams(queryParams)\n      if (query) {\n        url += query.charAt(0) === '?' ? query : `?${query}`\n      }\n    }\n\n    return url\n  }\n}\n\nexport default generateUrls\n"],"names":["cache","Map","router","options","ReferenceError","routesByName","routeName","params","route","get","clear","cacheRoutes","routes","has","name","Error","set","i","length","childRoute","parent","children","root","regexp","fullPath","rt","path","Array","isArray","tokens","pathToRegexp","parse","toPath","tokensToFunction","keys","Object","create","url","baseUrl","stringifyQueryParams","queryParams","key","query","charAt"],"mappings":";6QAWA,IAAMA,EAAQ,IAAIC,WAoBlB,SAAsBC,EAAQC,eAAAA,IAAAA,EAAU,KACjCD,QACG,IAAIE,eAAe,gCAG3BF,EAAOG,aAAeH,EAAOG,cAAgB,IAAIJ,IAE1C,SAACK,EAAWC,OACbC,EAAQN,EAAOG,aAAaI,IAAIH,QAC/BE,IACHN,EAAOG,aAAaK,QA5B1B,SAASC,EAAYN,EAAcG,EAAOI,MACpCP,EAAaQ,IAAIL,EAAMM,YACnB,IAAIC,gBAAgBP,EAAMM,4BAG9BN,EAAMM,MACRT,EAAaW,IAAIR,EAAMM,KAAMN,GAG3BI,MACG,IAAIK,EAAI,EAAGA,EAAIL,EAAOM,OAAQD,IAAK,KAChCE,EAAaP,EAAOK,GAC1BE,EAAWC,OAASZ,EACpBG,EAAYN,EAAcc,EAAYA,EAAWE,WAgBjDV,CAAYT,EAAOG,aAAcH,EAAOoB,KAAMpB,EAAOoB,KAAKD,UAE1Db,EAAQN,EAAOG,aAAaI,IAAIH,WAExB,IAAIS,gBAAgBT,qBAI1BiB,EAASvB,EAAMS,IAAID,EAAMgB,cACxBD,EAAQ,SACPC,EAAW,GACXC,EAAKjB,EACFiB,GAAI,KACHC,EAAOC,MAAMC,QAAQH,EAAGC,MAAQD,EAAGC,KAAK,GAAKD,EAAGC,KAClDA,IACFF,EAAWE,EAAOF,GAEpBC,EAAKA,EAAGL,eAEJS,EAASC,EAAaC,MAAMP,GAC5BQ,EAASF,EAAaG,iBAAiBJ,GACvCK,EAAOC,OAAOC,OAAO,MAClBnB,EAAI,EAAGA,EAAIY,EAAOX,OAAQD,IACR,iBAAdY,EAAOZ,KAChBiB,EAAKL,EAAOZ,GAAGH,OAAQ,GAG3BS,EAAS,CAAES,OAAAA,EAAQE,KAAAA,GACnBlC,EAAMgB,IAAIQ,EAAUD,GACpBf,EAAMgB,SAAWA,MAGfa,EAAMnC,EAAOoC,QAAUf,EAAOS,OAAOzB,EAAQJ,IAAY,OAEzDA,EAAQoC,sBAAwBhC,EAAQ,SACpCiC,EAAc,GACdN,EAAOC,OAAOD,KAAK3B,GAChBU,EAAI,EAAGA,EAAIiB,EAAKhB,OAAQD,IAAK,KAC9BwB,EAAMP,EAAKjB,GACZM,EAAOW,KAAKO,KACfD,EAAYC,GAAOlC,EAAOkC,QAGxBC,EAAQvC,EAAQoC,qBAAqBC,GACvCE,IACFL,GAA2B,MAApBK,EAAMC,OAAO,GAAaD,MAAYA,UAI1CL"}