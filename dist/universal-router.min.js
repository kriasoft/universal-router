/*! Universal Router | MIT License | https://www.kriasoft.com/universal-router/ */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).UniversalRouter=t()}(this,function(){"use strict";function e(e,t){return i(o(e,t))}var d=u,t=o,r=i,n=a,k="/",T=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function o(e,t){for(var r,n,o=[],i=0,a=0,u="",l=t&&t.delimiter||k,s=t&&t.whitelist||void 0,p=!1;null!==(r=T.exec(e));){var f=r[0],c=r[1],h=r.index;if(u+=e.slice(a,h),a=h+f.length,c)u+=c[1],p=!0;else{var v="",d=r[2],g=r[3],m=r[4],y=r[5];if(!p&&u.length){var x=u.length-1,b=u[x];(!s||-1<s.indexOf(b))&&(v=b,u=u.slice(0,x))}u&&(o.push(u),u="",p=!1);var w="+"===y||"*"===y,E="?"===y||"*"===y,R=g||m,j=v||l;o.push({name:d||i++,prefix:v,delimiter:j,optional:E,repeat:w,pattern:R?(n=R,n.replace(/([=!:$/()])/g,"\\$1")):"[^"+A(j===l?j:j+l)+"]+?"})}}return(u||a<e.length)&&o.push(u+e.substr(a)),o}function i(s){for(var p=new Array(s.length),e=0;e<s.length;e++)"object"==typeof s[e]&&(p[e]=new RegExp("^(?:"+s[e].pattern+")$"));return function(e,t){for(var r="",n=t&&t.encode||encodeURIComponent,o=0;o<s.length;o++){var i=s[o];if("string"!=typeof i){var a,u=e?e[i.name]:void 0;if(Array.isArray(u)){if(!i.repeat)throw new TypeError('Expected "'+i.name+'" to not repeat, but got array');if(0===u.length){if(i.optional)continue;throw new TypeError('Expected "'+i.name+'" to not be empty')}for(var l=0;l<u.length;l++){if(a=n(u[l],i),!p[o].test(a))throw new TypeError('Expected all "'+i.name+'" to match "'+i.pattern+'"');r+=(0===l?i.prefix:i.delimiter)+a}}else if("string"!=typeof u&&"number"!=typeof u&&"boolean"!=typeof u){if(!i.optional)throw new TypeError('Expected "'+i.name+'" to be '+(i.repeat?"an array":"a string"))}else{if(a=n(String(u),i),!p[o].test(a))throw new TypeError('Expected "'+i.name+'" to match "'+i.pattern+'", but got "'+a+'"');r+=i.prefix+a}}else r+=i}return r}}function A(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function v(e){return e&&e.sensitive?"":"i"}function a(e,t,r){for(var n=(r=r||{}).strict,o=!1!==r.start,i=!1!==r.end,a=r.delimiter||k,u=[].concat(r.endsWith||[]).map(A).concat("$").join("|"),l=o?"^":"",s=0;s<e.length;s++){var p=e[s];if("string"==typeof p)l+=A(p);else{var f=p.repeat?"(?:"+p.pattern+")(?:"+A(p.delimiter)+"(?:"+p.pattern+"))*":p.pattern;t&&t.push(p),p.optional?p.prefix?l+="(?:"+A(p.prefix)+"("+f+"))?":l+="("+f+")?":l+=A(p.prefix)+"("+f+")"}}if(i)n||(l+="(?:"+A(a)+")?"),l+="$"===u?"$":"(?="+u+")";else{var c=e[e.length-1],h="string"==typeof c?c[c.length-1]===a:void 0===c;n||(l+="(?:"+A(a)+"(?="+u+"))?"),h||(l+="(?="+A(a)+"|"+u+")")}return new RegExp(l,v(r))}function u(e,t,r){return e instanceof RegExp?function(e,t){if(!t)return e;var r=e.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)t.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return e}(e,t):Array.isArray(e)?function(e,t,r){for(var n=[],o=0;o<e.length;o++)n.push(u(e[o],t,r).source);return new RegExp("(?:"+n.join("|")+")",v(r))}(e,t,r):function(e,t,r){return a(o(e,r),t,r)}(e,t,r)}d.parse=t,d.compile=e,d.tokensToFunction=r,d.tokensToRegExp=n;var g=Object.prototype.hasOwnProperty,m=new Map;function y(t){try{return decodeURIComponent(t)}catch(e){return t}}function c(n,o,i,a,u){var l,s,p=0;return{next:function(e){if(n===e)return{done:!0};if(!l&&(l=function(e,t,r,n){var o=!e.children,i=(e.path||"")+"|"+o,a=m.get(i);if(!a){var u=[];a={keys:u,pattern:d(e.path||"",u,{end:o})},m.set(i,a)}var l=a.pattern.exec(t);if(!l)return null;for(var s=l[0],p=Object.assign({},n),f=1;f<l.length;f++){var c=a.keys[f-1],h=c.name,v=l[f];void 0===v&&g.call(p,h)||(c.repeat?p[h]=v?v.split(c.delimiter).map(y):[]:p[h]=v?y(v):v)}return{path:o||"/"!==s.charAt(s.length-1)?s:s.substr(1),keys:r.concat(a.keys),params:p}}(n,i,a,u)))return{done:!1,value:{route:n,baseUrl:o,path:l.path,keys:l.keys,params:l.params}};if(l&&n.children)for(;p<n.children.length;){if(!s){var t=n.children[p];t.parent=n,s=c(t,o+l.path,i.substr(l.path.length),l.keys,l.params)}var r=s.next(e);if(!r.done)return{done:!1,value:r.value};s=null,p++}return{done:!0}}}}function l(e,t){if("function"==typeof e.route.action)return e.route.action(e,t)}var s=(p.prototype.resolve=function(e){var t=this,i=Object.assign({},this.context,{},"string"==typeof e?{pathname:e}:e),a=c(this.root,this.baseUrl,i.pathname.substr(this.baseUrl.length),[],null),u=this.resolveRoute,l=null,s=null,p=i;function f(t,r,e){void 0===r&&(r=l.value.route);var n=null===e&&!l.done&&l.value.route;if(l=s||a.next(n),s=null,!t&&(l.done||!function(e,t){for(var r=t;r;)if((r=r.parent)===e)return!0;return!1}(r,l.value.route)))return s=l,Promise.resolve(null);if(l.done){var o=new Error("Route not found");return o.status=404,Promise.reject(o)}return p=Object.assign({},i,{},l.value),Promise.resolve(u(p,l.value.params)).then(function(e){return null!=e?e:f(t,r,e)})}return i.next=f,Promise.resolve().then(function(){return f(!0,t.root)}).catch(function(e){if(t.errorHandler)return t.errorHandler(e,p);throw e})},p);function p(e,t){if(void 0===t&&(t={}),!e||"object"!=typeof e)throw new TypeError("Invalid routes");this.baseUrl=t.baseUrl||"",this.errorHandler=t.errorHandler,this.resolveRoute=t.resolveRoute||l,this.context=Object.assign({router:this},t.context),this.root=Array.isArray(e)?{path:"",children:e,parent:null}:e,this.root.parent=null}return s.pathToRegexp=d,s});
//# sourceMappingURL=universal-router.min.js.map
