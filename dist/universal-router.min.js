/*! Universal Router | MIT License | https://www.kriasoft.com/universal-router/ */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e="undefined"!=typeof globalThis?globalThis:e||self).UniversalRouter=r()}(this,function(){"use strict";function n(e,r){void 0===r&&(r={});for(var n=function(e){for(var r=[],t=0;t<e.length;){var n=e[t];if("*"!==n&&"+"!==n&&"?"!==n)if("\\"!==n)if("{"!==n)if("}"!==n)if(":"!==n)if("("!==n)r.push({type:"CHAR",index:t,value:e[t++]});else{var i=1,o="";if("?"===e[u=t+1])throw new TypeError('Pattern cannot start with "?" at '+u);for(;u<e.length;)if("\\"!==e[u]){if(")"===e[u]){if(0===--i){u++;break}}else if("("===e[u]&&(i++,"?"!==e[u+1]))throw new TypeError("Capturing groups are not allowed at "+u);o+=e[u++]}else o+=e[u++]+e[u++];if(i)throw new TypeError("Unbalanced pattern at "+t);if(!o)throw new TypeError("Missing pattern at "+t);r.push({type:"PATTERN",index:t,value:o}),t=u}else{for(var a="",u=t+1;u<e.length;){var f=e.charCodeAt(u);if(!(48<=f&&f<=57||65<=f&&f<=90||97<=f&&f<=122||95===f))break;a+=e[u++]}if(!a)throw new TypeError("Missing parameter name at "+t);r.push({type:"NAME",index:t,value:a}),t=u}else r.push({type:"CLOSE",index:t,value:e[t++]});else r.push({type:"OPEN",index:t,value:e[t++]});else r.push({type:"ESCAPED_CHAR",index:t++,value:e[t++]});else r.push({type:"MODIFIER",index:t,value:e[t++]})}return r.push({type:"END",index:t,value:""}),r}(e),e=r.prefixes,t=void 0===e?"./":e,i="[^"+m(r.delimiter||"/#?")+"]+?",o=[],a=0,u=0,f="",s=function(e){if(u<n.length&&n[u].type===e)return n[u++].value},p=function(e){var r=s(e);if(void 0!==r)return r;var t=n[u],r=t.type,t=t.index;throw new TypeError("Unexpected "+r+" at "+t+", expected "+e)},l=function(){for(var e,r="";e=s("CHAR")||s("ESCAPED_CHAR");)r+=e;return r};u<n.length;){var d,c=s("CHAR"),h=s("NAME"),v=s("PATTERN");h||v?(-1===t.indexOf(d=c||"")&&(f+=d,d=""),f&&(o.push(f),f=""),o.push({name:h||a++,prefix:d,suffix:"",pattern:v||i,modifier:s("MODIFIER")||""})):(h=c||s("ESCAPED_CHAR"))?f+=h:(f&&(o.push(f),f=""),s("OPEN")?(d=l(),v=s("NAME")||"",c=s("PATTERN")||"",h=l(),p("CLOSE"),o.push({name:v||(c?a++:""),pattern:v&&!c?i:c,prefix:d,suffix:h,modifier:s("MODIFIER")||""})):p("END"))}return o}function c(e,r){var t=[];return function(o,a,e){void 0===e&&(e={});var e=e.decode,u=void 0===e?function(e){return e}:e;return function(e){var t=o.exec(e);if(!t)return!1;for(var r=t[0],e=t.index,n=Object.create(null),i=1;i<t.length;i++)!function(e){if(void 0===t[e])return;var r=a[e-1];"*"===r.modifier||"+"===r.modifier?n[r.name]=t[e].split(r.prefix+r.suffix).map(function(e){return u(e,r)}):n[r.name]=u(t[e],r)}(i);return{path:r,index:e,params:n}}}(u(e,t,r),t,r)}function m(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function x(e){return e&&e.sensitive?"":"i"}function a(e,r,t){return function(e,r,t){void 0===t&&(t={});for(var n=t.strict,i=void 0!==n&&n,o=t.start,a=void 0===o||o,u=t.end,n=void 0===u||u,o=t.encode,f=void 0===o?function(e){return e}:o,u="["+m(t.endsWith||"")+"]|$",o="["+m(t.delimiter||"/#?")+"]",s=a?"^":"",p=0,l=e;p<l.length;p++){var d,c,h,v=l[p];"string"==typeof v?s+=m(f(v)):(d=m(f(v.prefix)),c=m(f(v.suffix)),v.pattern?(r&&r.push(v),d||c?"+"===v.modifier||"*"===v.modifier?(h="*"===v.modifier?"?":"",s+="(?:"+d+"((?:"+v.pattern+")(?:"+c+d+"(?:"+v.pattern+"))*)"+c+")"+h):s+="(?:"+d+"("+v.pattern+")"+c+")"+v.modifier:s+="("+v.pattern+")"+v.modifier):s+="(?:"+d+c+")"+v.modifier)}n?(i||(s+=o+"?"),s+=t.endsWith?"(?="+u+")":"$"):(e=e[e.length-1],e="string"==typeof e?-1<o.indexOf(e[e.length-1]):void 0===e,i||(s+="(?:"+o+"(?="+u+"))?"),e||(s+="(?="+o+"|"+u+")"));return new RegExp(s,x(t))}(n(e,t),r,t)}function u(e,r,t){return e instanceof RegExp?function(e,r){if(!r)return e;for(var t=/\((?:\?<(.*?)>)?(?!\?)/g,n=0,i=t.exec(e.source);i;)r.push({name:i[1]||n++,prefix:"",suffix:"",modifier:"",pattern:""}),i=t.exec(e.source);return e}(e,r):Array.isArray(e)?(n=e,i=r,o=t,n=e.map(function(e){return u(e,i,o).source}),new RegExp("(?:"+n.join("|")+")",x(o))):a(e,r,t);var n,i,o}function t(r){try{return decodeURIComponent(r)}catch(e){return r}}function p(e,r){if("function"==typeof e.route.action)return e.route.action(e,r)}function e(e,r){if(!e||"object"!=typeof e)throw new TypeError("Invalid routes");this.options=Object.assign({decode:t},r),this.baseUrl=this.options.baseUrl||"",this.root=Array.isArray(e)?{path:"",children:e,parent:null}:e,this.root.parent=null}return e.prototype.resolve=function(e){var n,i,r=this,o=Object.assign({router:this},this.options.context,"string"==typeof e?{pathname:e}:e),a=function i(o,a,u,f,s){var p,l,d=0;return{next:function(e){if(o===e)return{done:!0,value:!1};if(!p){var r=o,t=!r.children;if(r.match||(r.match=c(r.path||"",Object.assign({end:t},u))),p=r.match(f))return r=p.path,p.path=t||"/"!==r.charAt(r.length-1)?r:r.substr(1),p.params=Object.assign({},s,p.params),{done:!1,value:{route:o,baseUrl:a,path:p.path,params:p.params}}}if(p&&o.children)for(;d<o.children.length;){l||((n=o.children[d]).parent=o,l=i(n,a+p.path,u,f.substr(p.path.length),p.params));var n=l.next(e);if(!n.done)return{done:!1,value:n.value};l=null,d++}return{done:!0,value:!1}}}}(this.root,this.baseUrl,this.options,o.pathname.substr(this.baseUrl.length)),u=this.options.resolveRoute||p,f=o;function s(r,t,e){void 0===t&&(t=!n.done&&n.value.route);e=null===e&&!n.done&&n.value.route;if(n=i||a.next(e),i=null,!r&&(n.done||!function(e,r){for(var t=r;t;)if((t=t.parent)===e)return 1}(t,n.value.route)))return i=n,Promise.resolve(null);if(n.done){e=new Error("Route not found");return e.status=404,Promise.reject(e)}return f=Object.assign({},o,n.value),Promise.resolve(u(f,n.value.params)).then(function(e){return null!=e?e:s(r,t,e)})}return o.next=s,Promise.resolve().then(function(){return s(!0,r.root)}).catch(function(e){if(r.options.errorHandler)return r.options.errorHandler(e,f);throw e})},e});
//# sourceMappingURL=universal-router.min.js.map
