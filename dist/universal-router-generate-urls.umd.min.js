!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e=e||self).UniversalRouter={})}(this,function(e){"use strict";var d=function(){return(d=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var o in r=arguments[t])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)},y=l,r=a,t=function(e,r){return i(a(e,r))},n=i,o=u,k="/",P=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function a(e,r){for(var t,n,o=[],a=0,i=0,u="",l=r&&r.delimiter||k,s=r&&r.whitelist||void 0,p=!1;null!==(t=P.exec(e));){var f=t[0],c=t[1],h=t.index;if(u+=e.slice(i,h),i=h+f.length,c)u+=c[1],p=!0;else{var v="",d=t[2],y=t[3],g=t[4],m=t[5];if(!p&&u.length){var x=u.length-1,w=u[x];(!s||-1<s.indexOf(w))&&(v=w,u=u.slice(0,x))}u&&(o.push(u),u="",p=!1);var b="+"===m||"*"===m,E="?"===m||"*"===m,R=y||g,j=v||l;o.push({name:d||a++,prefix:v,delimiter:j,optional:E,repeat:b,pattern:R?(n=R,n.replace(/([=!:$/()])/g,"\\$1")):"[^"+A(j===l?j:j+l)+"]+?"})}}return(u||i<e.length)&&o.push(u+e.substr(i)),o}function i(s){for(var p=new Array(s.length),e=0;e<s.length;e++)"object"==typeof s[e]&&(p[e]=new RegExp("^(?:"+s[e].pattern+")$"));return function(e,r){for(var t="",n=r&&r.encode||encodeURIComponent,o=0;o<s.length;o++){var a=s[o];if("string"!=typeof a){var i,u=e?e[a.name]:void 0;if(Array.isArray(u)){if(!a.repeat)throw new TypeError('Expected "'+a.name+'" to not repeat, but got array');if(0===u.length){if(a.optional)continue;throw new TypeError('Expected "'+a.name+'" to not be empty')}for(var l=0;l<u.length;l++){if(i=n(u[l],a),!p[o].test(i))throw new TypeError('Expected all "'+a.name+'" to match "'+a.pattern+'"');t+=(0===l?a.prefix:a.delimiter)+i}}else if("string"!=typeof u&&"number"!=typeof u&&"boolean"!=typeof u){if(!a.optional)throw new TypeError('Expected "'+a.name+'" to be '+(a.repeat?"an array":"a string"))}else{if(i=n(String(u),a),!p[o].test(i))throw new TypeError('Expected "'+a.name+'" to match "'+a.pattern+'", but got "'+i+'"');t+=a.prefix+i}}else t+=a}return t}}function A(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function v(e){return e&&e.sensitive?"":"i"}function u(e,r,t){for(var n=(t=t||{}).strict,o=!1!==t.start,a=!1!==t.end,i=t.delimiter||k,u=[].concat(t.endsWith||[]).map(A).concat("$").join("|"),l=o?"^":"",s=0;s<e.length;s++){var p=e[s];if("string"==typeof p)l+=A(p);else{var f=p.repeat?"(?:"+p.pattern+")(?:"+A(p.delimiter)+"(?:"+p.pattern+"))*":p.pattern;r&&r.push(p),p.optional?p.prefix?l+="(?:"+A(p.prefix)+"("+f+"))?":l+="("+f+")?":l+=A(p.prefix)+"("+f+")"}}if(a)n||(l+="(?:"+A(i)+")?"),l+="$"===u?"$":"(?="+u+")";else{var c=e[e.length-1],h="string"==typeof c?c[c.length-1]===i:void 0===c;n||(l+="(?:"+A(i)+"(?="+u+"))?"),h||(l+="(?="+A(i)+"|"+u+")")}return new RegExp(l,v(t))}function l(e,r,t){return e instanceof RegExp?function(e,r){if(!r)return e;var t=e.source.match(/\((?!\?)/g);if(t)for(var n=0;n<t.length;n++)r.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return e}(e,r):Array.isArray(e)?function(e,r,t){for(var n=[],o=0;o<e.length;o++)n.push(l(e[o],r,t).source);return new RegExp("(?:"+n.join("|")+")",v(t))}(e,r,t):function(e,r,t){return u(a(e,t),r,t)}(e,r,t)}y.parse=r,y.compile=t,y.tokensToFunction=n,y.tokensToRegExp=o;var g=Object.prototype.hasOwnProperty,m=new Map;function x(r){try{return decodeURIComponent(r)}catch(e){return r}}function w(n,o,a,i,u){var l,s=null,p=0;return{next:function(e){if(n===e)return{done:!0,value:void 0};if(!s&&(s=function(e,r,t,n){var o=!e.children,a=(e.path||"")+"|"+o,i=m.get(a);if(!i){var u=[];i={keys:u,pattern:y(e.path||"",u,{end:o})},m.set(a,i)}var l=i.pattern.exec(r);if(!l)return null;for(var s=l[0],p=d({},n),f=1;f<l.length;f++){var c=i.keys[f-1],h=c.name,v=l[f];void 0===v&&g.call(p,h)||(c.repeat?p[h]=v?v.split(c.delimiter).map(x):[]:p[h]=v?x(v):v)}return{path:o||"/"!==s.charAt(s.length-1)?s:s.substr(1),keys:t.concat(i.keys),params:p}}(n,a,i,u)))return{done:!1,value:{route:n,baseUrl:o,path:s.path,keys:s.keys,params:s.params}};if(s&&n.children)for(;p<n.children.length;){if(!l){var r=n.children[p];r.parent=n,l=w(r,o+s.path,a.substr(s.path.length),s.keys,s.params)}var t=l.next(e);if(!t.done)return{done:!1,value:t.value};l=null,p++}return{done:!0,value:void 0}}}}function s(e,r){if("function"==typeof e.route.action)return e.route.action(e,r)}var p=function(){function e(e,r){if(void 0===r&&(r={context:{}}),!e||"object"!=typeof e)throw new TypeError("Invalid routes");this.baseUrl=r.baseUrl||"",this.errorHandler=r.errorHandler,this.resolveRoute=r.resolveRoute||s,this.context=d({router:this},r.context),this.root=Array.isArray(e)?{path:"",children:e,parent:null}:e,this.root.parent=null}return e.prototype.resolve=function(e){var r=this,u=d({},this.context,"string"==typeof e?{pathname:e}:e),l=w(this.root,this.baseUrl,u.pathname.substr(this.baseUrl.length),[],null),s=this.resolveRoute,p=null,f=null,c=u;function h(r,t,e){void 0===t&&(t=p&&p.value?p.value.route:null);var n=p&&p.value?p.value.route:null,o=null===e?n:null;if(p=f||l.next(o),f=null,!r&&(p.done||!function(e,r){if(null===e)return!1;for(var t=r;t;)if((t=t.parent)===e)return!0;return!1}(t,p.value.route)))return f=p,Promise.resolve(null);if(p.done){var a=new Error("Route not found");return a.status=404,Promise.reject(a)}var i=d({},u,p.value);return c=i,Promise.resolve(s(i,p.value.params)).then(function(e){return null!=e?e:h(r,t,e)})}return u.next=h,Promise.resolve().then(function(){return h(!0,r.root)}).catch(function(e){if(r.errorHandler)return r.errorHandler(e,c);throw e})},e.pathToRegexp=y,e}(),b=p.pathToRegexp,E=new Map;e.UniversalRouter=p,e.generateUrls=function(g,m){if(!(void 0===m&&(m={}),g instanceof p||"object"==typeof g&&g&&g.root))throw new TypeError("An instance of UniversalRouter is expected");return g.routesByName=g.routesByName||new Map,function(e,r){var t=g.routesByName,n=t.get(e);if(!(n||(t.clear(),function e(r,t,n){if(r.has(t.name))throw new Error('Route "'+t.name+'" already exists');if(t.name&&r.set(t.name,t),n)for(var o=0;o<n.length;o++){var a=n[o];a.parent=t,e(r,a,a.children)}}(t,g.root,g.root.children),n=t.get(e))))throw new Error('Route "'+e+'" not found');var o=E.get(n.fullPath);if(!o){for(var a="",i=n;i;){var u=Array.isArray(i.path)?i.path[0]:i.path;u&&(a=u+a),i=i.parent}for(var l=b.parse(a),s=b.tokensToFunction(l),p=Object.create(null),f=0;f<l.length;f++){var c=l[f];"string"!=typeof c&&(p[c.name]=!0)}o={toPath:s,keys:p},E.set(a,o),n.fullPath=a}var h=g.baseUrl+o.toPath(r,m)||"/";if(m.stringifyQueryParams&&r){var v={};for(p=Object.keys(r),f=0;f<p.length;f++){var d=p[f];o.keys[d]||(v[d]=r[d])}var y=m.stringifyQueryParams(v);y&&(h+="?"===y.charAt(0)?y:"?"+y)}return h}},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=universal-router-generate-urls.umd.min.js.map
