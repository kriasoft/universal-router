!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).UniversalRouter=t()}(this,function(){"use strict";var d=function(){return(d=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},y=u,e=o,t=function(e,t){return a(o(e,t))},r=a,n=i,k="/",T=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function o(e,t){for(var r,n,o=[],a=0,i=0,u="",l=t&&t.delimiter||k,p=t&&t.whitelist||void 0,s=!1;null!==(r=T.exec(e));){var f=r[0],c=r[1],h=r.index;if(u+=e.slice(i,h),i=h+f.length,c)u+=c[1],s=!0;else{var v="",d=r[2],y=r[3],g=r[4],m=r[5];if(!s&&u.length){var x=u.length-1,w=u[x];(!p||-1<p.indexOf(w))&&(v=w,u=u.slice(0,x))}u&&(o.push(u),u="",s=!1);var b="+"===m||"*"===m,E="?"===m||"*"===m,R=y||g,j=v||l;o.push({name:d||a++,prefix:v,delimiter:j,optional:E,repeat:b,pattern:R?(n=R,n.replace(/([=!:$/()])/g,"\\$1")):"[^"+A(j===l?j:j+l)+"]+?"})}}return(u||i<e.length)&&o.push(u+e.substr(i)),o}function a(p){for(var s=new Array(p.length),e=0;e<p.length;e++)"object"==typeof p[e]&&(s[e]=new RegExp("^(?:"+p[e].pattern+")$"));return function(e,t){for(var r="",n=t&&t.encode||encodeURIComponent,o=0;o<p.length;o++){var a=p[o];if("string"!=typeof a){var i,u=e?e[a.name]:void 0;if(Array.isArray(u)){if(!a.repeat)throw new TypeError('Expected "'+a.name+'" to not repeat, but got array');if(0===u.length){if(a.optional)continue;throw new TypeError('Expected "'+a.name+'" to not be empty')}for(var l=0;l<u.length;l++){if(i=n(u[l],a),!s[o].test(i))throw new TypeError('Expected all "'+a.name+'" to match "'+a.pattern+'"');r+=(0===l?a.prefix:a.delimiter)+i}}else if("string"!=typeof u&&"number"!=typeof u&&"boolean"!=typeof u){if(!a.optional)throw new TypeError('Expected "'+a.name+'" to be '+(a.repeat?"an array":"a string"))}else{if(i=n(String(u),a),!s[o].test(i))throw new TypeError('Expected "'+a.name+'" to match "'+a.pattern+'", but got "'+i+'"');r+=a.prefix+i}}else r+=a}return r}}function A(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function v(e){return e&&e.sensitive?"":"i"}function i(e,t,r){for(var n=(r=r||{}).strict,o=!1!==r.start,a=!1!==r.end,i=r.delimiter||k,u=[].concat(r.endsWith||[]).map(A).concat("$").join("|"),l=o?"^":"",p=0;p<e.length;p++){var s=e[p];if("string"==typeof s)l+=A(s);else{var f=s.repeat?"(?:"+s.pattern+")(?:"+A(s.delimiter)+"(?:"+s.pattern+"))*":s.pattern;t&&t.push(s),s.optional?s.prefix?l+="(?:"+A(s.prefix)+"("+f+"))?":l+="("+f+")?":l+=A(s.prefix)+"("+f+")"}}if(a)n||(l+="(?:"+A(i)+")?"),l+="$"===u?"$":"(?="+u+")";else{var c=e[e.length-1],h="string"==typeof c?c[c.length-1]===i:void 0===c;n||(l+="(?:"+A(i)+"(?="+u+"))?"),h||(l+="(?="+A(i)+"|"+u+")")}return new RegExp(l,v(r))}function u(e,t,r){return e instanceof RegExp?function(e,t){if(!t)return e;var r=e.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)t.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return e}(e,t):Array.isArray(e)?function(e,t,r){for(var n=[],o=0;o<e.length;o++)n.push(u(e[o],t,r).source);return new RegExp("(?:"+n.join("|")+")",v(r))}(e,t,r):function(e,t,r){return i(o(e,r),t,r)}(e,t,r)}y.parse=e,y.compile=t,y.tokensToFunction=r,y.tokensToRegExp=n;var g=Object.prototype.hasOwnProperty,m=new Map;function x(t){try{return decodeURIComponent(t)}catch(e){return t}}function w(n,o,a,i,u){var l,p=null,s=0;return{next:function(e){if(n===e)return{done:!0,value:void 0};if(!p&&(p=function(e,t,r,n){var o=!e.children,a=(e.path||"")+"|"+o,i=m.get(a);if(!i){var u=[];i={keys:u,pattern:y(e.path||"",u,{end:o})},m.set(a,i)}var l=i.pattern.exec(t);if(!l)return null;for(var p=l[0],s=d({},n),f=1;f<l.length;f++){var c=i.keys[f-1],h=c.name,v=l[f];void 0===v&&g.call(s,h)||(c.repeat?s[h]=v?v.split(c.delimiter).map(x):[]:s[h]=v?x(v):v)}return{path:o||"/"!==p.charAt(p.length-1)?p:p.substr(1),keys:r.concat(i.keys),params:s}}(n,a,i,u)))return{done:!1,value:{route:n,baseUrl:o,path:p.path,keys:p.keys,params:p.params}};if(p&&n.children)for(;s<n.children.length;){if(!l){var t=n.children[s];t.parent=n,l=w(t,o+p.path,a.substr(p.path.length),p.keys,p.params)}var r=l.next(e);if(!r.done)return{done:!1,value:r.value};l=null,s++}return{done:!0,value:void 0}}}}function l(e,t){if("function"==typeof e.route.action)return e.route.action(e,t)}return function(){function e(e,t){if(void 0===t&&(t={context:{}}),!e||"object"!=typeof e)throw new TypeError("Invalid routes");this.baseUrl=t.baseUrl||"",this.errorHandler=t.errorHandler,this.resolveRoute=t.resolveRoute||l,this.context=d({router:this},t.context),this.root=Array.isArray(e)?{path:"",children:e,parent:null}:e,this.root.parent=null}return e.prototype.resolve=function(e){var t=this,u=d({},this.context,"string"==typeof e?{pathname:e}:e),l=w(this.root,this.baseUrl,u.pathname.substr(this.baseUrl.length),[],null),p=this.resolveRoute,s=null,f=null,c=u;function h(t,r,e){void 0===r&&(r=s&&s.value?s.value.route:null);var n=s&&s.value?s.value.route:null,o=null===e?n:null;if(s=f||l.next(o),f=null,!t&&(s.done||!function(e,t){if(null===e)return!1;for(var r=t;r;)if((r=r.parent)===e)return!0;return!1}(r,s.value.route)))return f=s,Promise.resolve(null);if(s.done){var a=new Error("Route not found");return a.status=404,Promise.reject(a)}var i=d({},u,s.value);return c=i,Promise.resolve(p(i,s.value.params)).then(function(e){return null!=e?e:h(t,r,e)})}return u.next=h,Promise.resolve().then(function(){return h(!0,t.root)}).catch(function(e){if(t.errorHandler)return t.errorHandler(e,c);throw e})},e.pathToRegexp=y,e}()});
//# sourceMappingURL=universal-router.umd.min.js.map
